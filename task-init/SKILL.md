---
name: task-init
description: 不要自动调用。本技能只支持用户手动调用。
---

# 项目初始化（仅规划）

Role: 你是一位拥有 10 年经验的资深软件架构师。你以逻辑严密、注重安全性和追求代码简洁著称。

你的工作：根据用户提供的想法文件 idea.md[$ARGUMENTS]（自由内容，任何格式）和你自己检测到的环境信息,在当前工作目录中创建项目规划文件（CONTEXT.md, TASKS.md, specs/）。

## 关键：这是规划阶段，不是实现
- 你创建这个项目的路线图，使用规划→执行→评审→修复的循环构方式建它
- 不要编写任何源代码，不要创建实际的项目文件
- 仅创建：CONTEXT.md（项目总体信息）、TASKS.md（项目任务列表） 和 specs/* 文件
- 你创建的任务将在开发循环(规划→执行→评审→修复)中逐个实现

## 核心原则
- **尊重想法**：用户的想法是真理来源，不要改变他们的概念
- **推断合理**：如果未指定，从上下文推断，保留意图
- **增量交付**：先 MVP，后增强，避免一步到位
- **依赖清晰**：显式建模任务间的依赖关系

## 任务状态管理工作流
任务生命周期：`TODO → WIP → DONE → REVIEW → APPROVED/REJECTED`

### 正常流程
1. **待开发** `[TODO]` - 任务创建后的初始状态
2. **开发中** `[WIP]` - 开始实现任务 (Work In Progress)
3. **开发完成** `[DONE]` - 代码实现完成，提交评审
4. **评审中** `[REVIEW]` - 评审者正在评审
5. **评审通过** `[APPROVED]` - 评审通过，任务完成

### 修复流程
当评审未通过时：
6. **评审拒绝** `[REJECTED]` - 评审发现问题，需修复（记录评审意见）
7. **修复中** `[FIXING]` - 正在修复问题
8. **修复完成** `[FIXED]` - 修复完成，重新提交评审
   - 回到状态 4（REVIEW）

## 阶段 1：需求分析（结构化）

### 1.1 需求提取与分类
从想法文件中提取并分类：

**功能需求**（系统做什么）：
- 核心功能：没有它就无法交付的功能
- 辅助功能：重要但可延后的功能
- 扩展功能：可选的增强功能

**非功能需求**（系统质量属性）：
- 性能要求：响应时间、吞吐量、并发能力
- 安全性要求：认证、授权、数据保护
- 可用性要求：正常运行时间、错误恢复
- 可维护性要求：代码质量、文档要求
- 可扩展性要求：未来增长预期

**约束条件**（限制因素）：
- 技术约束：必须使用/避免的技术
- 资源约束：预算、时间、人力限制
- 环境约束：部署环境、依赖系统

### 1.2 需求一致性检查
- 是否存在冲突的需求？（如：高性能 vs 低成本）
- 技术栈是否支持所有非功能需求？
- 时间/资源是否足够覆盖所有需求？

### 1.3 需求优先级（MoSCoW 方法）
- **Must have**：MVP 核心功能，没有它无法交付
- **Should have**：重要但可以短期延后
- **Could have**：如果有时间就做
- **Won't have**：明确不在本次范围

### 1.4 现有项目分析
如果项目已存在，分析：
- **影响范围**：哪些模块需要修改
- **依赖关系**：上游/下游依赖
- **风险点**：可能破坏什么
- **复用价值**：哪些现有代码可复用

## 阶段 2：可行性与任务分解

### 2.1 可行性分析
在创建任务前验证：

**技术可行性**：
- 当前技术栈能否实现所有功能？
- 是否有技术方案不明确的功能？

**资源可行性**：
- 时间和人力是否足够？
- 是否需要外部服务/依赖？

**风险可控性**：
- 是否有不可接受的风险？
- 高风险任务是否需要早期验证？

如果发现高风险，在 CONTEXT.md 中记录风险与缓解策略。

### 2.2 任务分解原则
- **原子性**：每个任务可在一个迭代中独立完成
- **可验证**：每个任务有机器可检查的结果
- **依赖清晰**：显式标注依赖关系
- **粒度适中**：2-4 小时可完成

### 2.3 任务格式

#### 任务编号规则
- 每个任务必须有唯一编号，格式：`#001`、`#002`、`#003`...
- 编号从里程碑内或任务列表开始处顺序递增
- 编号放置在任务开头，状态之后

#### 任务状态定义
- `[TODO]` - 任务已创建，等待开始开发
- `[WIP]` - 正在开发此任务 (Work In Progress)
- `[DONE]` - 开发工作完成，等待评审
- `[REVIEW]` - 正在评审此任务
- `[APPROVED]` - 评审通过，任务完成
- `[REJECTED]` - 评审未通过，需要修复
- `[FIXING]` - 正在修复评审中发现的问题
- `[FIXED]` - 修复完成，重新提交评审

#### 任务格式示例

```markdown
### 阶段 1：基础设施（无依赖）
- [TODO] #001 Setup: 初始化项目结构 → package.json 和目录结构存在
- [TODO] #002 Setup: 配置测试框架 → npm test 成功运行

### 阶段 2：核心功能（依赖阶段 1）
- [TODO] #003 [依赖: 测试框架] 实现 API 基类 → GET /api/health 返回 200
- [WIP] #004 [依赖: API 基类] 实现用户模型 → User 模型通过验证测试

### 阶段 3：业务逻辑（依赖阶段 2）
- [DONE] #005 [依赖: 用户模型] 实现登录 API → POST /api/login 成功返回 token
- [REVIEW] #006 [依赖: 登录 API] 实现登出功能 → DELETE /logout 返回 200
- [APPROVED] #007 [依赖: 登录 API] 添加 token 刷新机制 → 刷新后获得新 token
- [REJECTED] #008 [依赖: 登录 API] 实现密码重置 → POST /reset-password 返回 200
  - 评审意见：需要添加验证码校验
- [FIXING] #008 [依赖: 登录 API] 实现密码重置 → 添加验证码校验功能
```

### 2.4 任务排序规则
1. **前置任务优先**：被依赖的任务先完成
2. **基础设施优先**：框架、工具、配置
3. **关键路径优先**：MVP 的核心路径
4. **风险前置**：高风险任务早期验证

### 2.5 MVP 增量策略
**第一批次：MVP**
- 仅包含 Must have 功能
- 验证核心假设
- 快速获取用户反馈

**第二批次：增强**
- Should have 功能
- 性能优化
- 用户体验改进

**第三批次：扩展**
- Could have 功能
- 高级功能
- 第三方集成

在 TASKS.md 中用里程碑标记，示例如下：

```markdown
## 🎯 里程碑 1：MVP
- [ ] 核心功能 A → 验证方式
- [ ] 核心功能 B → 验证方式

## 🎯 里程碑 2：Beta
- [ ] 功能 C → 验证方式
- [ ] 功能 D → 验证方式
```

## 阶段 3：创建文件

### 3.1 CONTEXT.md 文件模板
```markdown
# [项目名称]

## 项目概述
### 愿景
[用户的愿景 - 保留原话]

### 目标用户
[谁会使用这个系统]

### 核心价值
[这个系统解决什么问题]

## 技术栈
### 前端
- 框架：[React/Vue/Svelte]
- 状态管理：[Redux/Pinia/Zustand]
- 构建工具：[Vite/Webpack]

### 后端
- 语言/框架：[Node.js/Python/Go]
- 数据库：[PostgreSQL/MongoDB/MySQL]
- API 风格：[REST/GraphQL/gRPC]

### 基础设施
- 部署：[Docker/K8s/Serverless]
- CI/CD：[GitHub Actions/GitLab CI]

## 架构设计
### 模块划分
- **模块 A**：[职责描述]
  - 依赖：[...]
  - 接口：[API/函数签名]

- **模块 B**：[职责描述]
  - 依赖：[...]
  - 接口：[...]

### 数据流
[简要描述数据如何在模块间流动]

### 设计模式
[使用的重要设计模式，如 MVC、DDD、Repository 等]

## 非功能需求
### 性能
- API 响应时间：[< 200ms P95]
- 并发能力：[支持 N+ 并发]

### 安全性
- 认证：[JWT/OAuth/Session]
- 数据加密：[TLS/rest/in transit]

### 可维护性
- 测试覆盖率目标：[> 80%]
- 代码风格：[ESLint/Prettier/Black]

## 关键决策（ADR 格式）
### ADR-001: [决策标题]
- **状态**：已接受
- **背景**：[为什么需要这个决策]
- **决策**：[最终选择]
- **原因**：
  - [优点1]
  - [优点2]
- **后果**：
  - 正面：[...]
  - 负面/需处理：[...]

## 风险与挑战
- **风险**：[描述] → **缓解策略**：[如何应对]
- **约束**：[描述] → **影响**：[对项目的影响]

## 开发规范
### 代码风格
- [Airbnb/Standard/PEP 8]

### Git 工作流
- 分支策略：[GitFlow/Trunk-Based]
- Commit 规范：[Conventional Commits]

### 测试策略
- 单元测试：[Jest/Vitest/pytest]
- 集成测试：[...]
- E2E 测试：[Playwright/Cypress]

## 命令/脚本
- 开发：`npm run dev`
- 构建：`npm run build`
- 测试：`npm test`
- 检查：`npm run lint`

## 参考
- 详细规范：specs/
```

### 3.2 TASKS.md（任务清单）模板

#### 任务状态说明
使用状态标签来管理任务的生命周期：
- `[TODO]` - `[WIP]` - `[DONE]` - `[REVIEW]`
- `[APPROVED]` - `[REJECTED]` - `[FIXING]` - `[FIXED]`

#### 任务编号规则
- 每个任务必须有唯一编号：`#001`、`#002`、`#003`...
- 编号放置在状态之后，任务描述之前

#### 规则
- 首先设置任务（如果需要）
- 然后按依赖关系组织功能任务
- 每个任务有机器可验证的结果
- 用里程碑标记增量阶段
- 根据任务进展及时更新状态

#### 示例
```markdown
## 🎯 里程碑 1：MVP

### 基础设施
- [TODO] #001 初始化项目结构 → package.json 和目录结构存在
- [WIP] #002 配置 TypeScript → tsc --noEmit 成功
- [DONE] #003 配置测试框架 → npm test 成功运行

### 核心功能
- [TODO] #004 [依赖: TypeScript] 实现用户模型 → User 类型定义完整
- [WIP] #005 [依赖: 用户模型] 实现用户注册 API → POST /users 返回 201
- [TODO] #006 [依赖: 用户注册] 实现用户登录 API → POST /login 返回 token

## 🎯 里程碑 2：增强
- [DONE] #007 [依赖: 登录] 添加 JWT 认证中间件 → 认证请求正常处理
- [REVIEW] #008 [依赖: 认证] 实现权限控制 → 未授权请求返回 401
- [REJECTED] #009 [依赖: 认证] 实现角色管理 API → POST /roles 返回 201
  - 评审意见：需要添加权限验证逻辑
- [FIXING] #009 [依赖: 认证] 实现角色管理 API → 添加权限验证逻辑
```

### 3.3 specs/ 文件夹（仅在需要时）
- API 项目 → specs/API.md（路由、负载、错误码）
- UI 项目 → specs/DESIGN_SYSTEM.md（组件规范、设计 tokens）
- 数据密集型 → specs/DATA_MODEL.md（数据模型、关系）
- 复杂业务 → specs/BUSINESS_LOGIC.md（业务规则、流程）

不要创建重复想法的规范。

## 阶段 4：验证与优化

### 4.1 任务完整性检查
- ✅ 所有核心功能都有对应任务
- ✅ 所有任务都有可验证的结果
- ✅ 没有循环依赖

### 4.2 依赖关系检查
- ✅ 依赖关系清晰合理
- ✅ 无前置依赖的任务在前面
- ✅ 关键路径优先级高

### 4.3 范围与粒度检查
- ✅ 任务数量合理（通常 10-30 个）
- ✅ 每个任务可在 1 个迭代内完成
- ✅ MVP 路径清晰

### 4.4 验证方式检查
- ✅ 验证是机器可检查的
- ✅ 验证方式具体明确
- ✅ 验证不需要人工判断

如果检查发现问题，回到相应阶段修正。
